version: '3.8'

services:
  MonitorFlux:
    container_name: MonitorFlux
    build:
      context: .
    environment:
      - MQTT_HOST=mqtt
      - MQTT_PORT=1883
      - MQTT_USERNAME=admin
      - MQTT_PASSWORD=secret
      - MQTT_ROOT_TOPIC=MonitorFlux
    depends_on:
      - mqtt
    ports:
      - "8085:8080" # Optional f√ºr Web-/API-Endpoints
    restart: no
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  mqtt:
    container_name: mqtt-dev
    image: eclipse-mosquitto
    ports:
      - "1886:1883"
    volumes:
      - mosquitto_data:/mosquitto/data
      - mosquitto_log:/mosquitto/log
    environment:
      - MQTT_ALLOW_ANONYMOUS=false
      - MQTT_USERNAME=admin
      - MQTT_PASSWORD=secret
    restart: unless-stopped

volumes:
  mosquitto_data:
  mosquitto_log:
